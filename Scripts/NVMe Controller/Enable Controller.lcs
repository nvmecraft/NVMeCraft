NVMeDevice dev;
Serilog.Core.Logger log;

public int ScriptMain(int a, int b)
{
    dev = FromEngine.dev;
    log = FromEngine.log;
    
    System.Diagnostics.Stopwatch sw = new System.Diagnostics.Stopwatch();
    
    UInt64 CAP_TO = dev.controllerRegs.CAP.TO;
    
    log.Information("CAP.TO - CC.EN = 0");
    dev.controllerRegs.CC.IOSQES = 6;
    dev.controllerRegs.CC.IOCQES = 4;
    dev.controllerRegs.CC.EN = 1;;
    
    sw.Start();
    while(true)
    {
        Thread.Sleep(10);
        if(dev.controllerRegs.CSTS.RDY == 1)
        {
            sw.Stop();
            log.Information("CSTS.RDY = 1, Elapsed Time is {0}", sw.ElapsedMilliseconds.ToString());
            break;
        }
        
        if(sw.ElapsedMilliseconds > (Int64)(CAP_TO * 500))
        {
            sw.Stop();
            log.Information("CAP.TO - Timeout occured. {0}", sw.ElapsedMilliseconds.ToString());
            break;
        }
    }
    
    return 0;
}