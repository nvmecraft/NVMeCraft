/// <summary>
/// To validate the MPSMAX field of the Controller Capabilities (CAP) register of an NVMe Controller.
/// </summary>
/// <Test Procedure>
/// 1. Configure the NVMe Host to read the CAP.MPSMAX register field (bits 55:52) of the NVMe Controller.
/// </Test Procedure>
/// <Observable Results>
/// 1. Verify that the value of the CAP.MPSMAX register field is greater than or equal to the value of the
/// CAP.MPSMIN register field.
/// </Observable Results>
    
NVMeDevice dev;
Serilog.Core.Logger log;

public int ScriptMain(int a, int b)
{
    dev = FromEngine.dev;
    log = FromEngine.log;
    
    log.Information("CAP.MPSMAX - CHECK");

    UInt64 MPSMAX = dev.controllerRegs.CAP.MPSMAX;
    
    log.Information("CAP.MPSMAX - 0x{0:X2}, The maximum memory page size is {1}.", MPSMAX, Math.Pow(2, (12 + MPSMAX)));
    
    PassOrFail(MPSMAX);
   
    return 0;
}

public void PassOrFail(UInt64 mpsmax)
{
    UInt64 MPSMIN = dev.controllerRegs.CAP.MPSMIN;
    
    if(mpsmax >= MPSMIN)
        log.Information("CAP.MPSMAX - PASS");
    else
        log.Information("CAP.MPSMAX - FAIL");
        
}